<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Blog (Vanilla JS)</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: Georgia, "Times New Roman", serif;
      padding: 24px;
    }
    .site-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .site-header h1 { font-size: 34px; margin-bottom: 6px; }
    .site-header .count { font-size: 24px; font-weight: 600; }
    .post-img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border: 1px solid #ddd;
      display: block;
      margin-bottom: 10px;
    }
    .card + .card { margin-top: 18px; }
    .small-label { width: 120px; display: inline-block; }
    @media (max-width: 576px) {
      .post-img { width: 100%; height: auto; }
    }
  </style>
</head>
<body>

  <div class="container">
    <header class="site-header">
      <h1>Your Blog</h1>
      <div class="count">Total Blog: <span id="totalCount">0</span></div>
    </header>

    <!-- Form -->
    <section class="mb-4">
      <form id="postForm" class="row g-3 align-items-center">
        <div class="col-12">
          <label class="form-label small-label">Image Url:</label>
          <input id="imageUrl" class="form-control d-inline-block" style="max-width:600px;" placeholder="https://..." />
        </div>

        <div class="col-12">
          <label class="form-label small-label">Title:</label>
          <input id="title" class="form-control d-inline-block" style="max-width:400px;" placeholder="A blog title" />
        </div>

        <div class="col-12">
          <label class="form-label small-label">Blog Description:</label>
          <input id="description" class="form-control d-inline-block" style="max-width:600px;" placeholder="Write something..." />
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-outline-primary">POST BLOG</button>
        </div>
      </form>
    </section>

    <hr />

    <!-- Posts container -->
    <section id="postsContainer"></section>
  </div>

  <!-- Vanilla JS -->
  <script>
    (function() {
      const STORAGE_KEY = 'simple_blog_posts_v1';

      // Elements
      const form = document.getElementById('postForm');
      const imageUrlInput = document.getElementById('imageUrl');
      const titleInput = document.getElementById('title');
      const descInput = document.getElementById('description');
      const postsContainer = document.getElementById('postsContainer');
      const totalCountEl = document.getElementById('totalCount');

      // Posts array
      let posts = [];

      // Load posts from localStorage
      function loadPosts() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          try {
            posts = JSON.parse(raw) || [];
          } catch(e) {
            console.error('Could not parse posts from storage', e);
            posts = [];
          }
        } else {
          posts = [];
        }
      }

      // Save posts to localStorage
      function savePosts() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
      }

      // Render posts to DOM
      function renderPosts() {
        postsContainer.innerHTML = '';
        totalCountEl.textContent = posts.length;
        if (posts.length === 0) {
          const p = document.createElement('p');
          p.textContent = 'No posts yet â€” add one above.';
          postsContainer.appendChild(p);
          return;
        }

        posts.forEach(post => {
          const card = document.createElement('div');
          card.className = 'card';

          const cardBody = document.createElement('div');
          cardBody.className = 'card-body';

          // Title
          const h2 = document.createElement('h3');
          h2.className = 'card-title';
          h2.textContent = post.title;
          cardBody.appendChild(h2);

          // Image
          const img = document.createElement('img');
          img.className = 'post-img';
          img.src = post.imageUrl;
          img.alt = post.title;
          // fallback if image fails to load
          img.onerror = function() {
            img.onerror = null;
            img.src = 'data:image/svg+xml;charset=UTF-8,' +
              encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="300" height="180"><rect width="100%" height="100%" fill="#f3f3f3"/><text x="50%" y="50%" font-family="Arial" font-size="14" fill="#888" text-anchor="middle" alignment-baseline="middle">Image not found</text></svg>');
          };
          cardBody.appendChild(img);

          // Description
          const p = document.createElement('p');
          p.className = 'card-text';
          p.textContent = post.description;
          cardBody.appendChild(p);

          // Actions: Edit, Delete
          const btnGroup = document.createElement('div');
          btnGroup.className = 'mt-2';

          const editBtn = document.createElement('button');
          editBtn.className = 'btn btn-sm btn-outline-secondary me-2';
          editBtn.textContent = 'Edit Blog';
          editBtn.onclick = () => startEdit(post.id);

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn btn-sm btn-outline-danger';
          deleteBtn.textContent = 'Delete Blog';
          deleteBtn.onclick = () => {
            if (confirm('Delete this blog?')) {
              deletePost(post.id);
            }
          };

          btnGroup.appendChild(editBtn);
          btnGroup.appendChild(deleteBtn);
          cardBody.appendChild(btnGroup);

          card.appendChild(cardBody);
          postsContainer.appendChild(card);
        });
      }

      // Create a new post
      function addPost(data) {
        // newest first
        posts.unshift(data);
        savePosts();
        renderPosts();
      }

      // Delete post by id
      function deletePost(id) {
        posts = posts.filter(p => p.id !== id);
        savePosts();
        renderPosts();
      }

      // Start editing: populate form and change submit behavior
      let editingId = null;
      function startEdit(id) {
        const post = posts.find(p => p.id === id);
        if (!post) return;
        editingId = id;
        imageUrlInput.value = post.imageUrl;
        titleInput.value = post.title;
        descInput.value = post.description;

        // Change button text to "Save Changes"
        const btn = form.querySelector('button[type="submit"]');
        btn.textContent = 'Save Changes';
        btn.classList.remove('btn-outline-primary');
        btn.classList.add('btn-primary');
      }

      // Apply edit
      function applyEdit(id, updated) {
        posts = posts.map(p => (p.id === id ? {...p, ...updated } : p));
        editingId = null;
        savePosts();
        renderPosts();

        // reset form button text
        const btn = form.querySelector('button[type="submit"]');
        btn.textContent = 'POST BLOG';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-primary');
      }

      // Form submit
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const imageUrl = imageUrlInput.value.trim();
        const title = titleInput.value.trim();
        const description = descInput.value.trim();

        if (!title) {
          alert('Please enter a title.');
          return;
        }
        if (!imageUrl) {
          alert('Please enter an image URL.');
          return;
        }

        if (editingId) {
          applyEdit(editingId, { imageUrl, title, description });
          form.reset();
          return;
        }

        const newPost = {
          id: Date.now().toString(),
          imageUrl,
          title,
          description,
          createdAt: new Date().toISOString()
        };

        addPost(newPost);
        form.reset();
      });

      // initial load
      loadPosts();
      renderPosts();

    })();
  </script>
</body>
</html>
